<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>數字易經</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        input { padding: 10px; margin: 10px; font-size: 16px; }
        button { padding: 10px; font-size: 16px; cursor: pointer; }
        #output { margin-top: 20px; font-size: 20px; font-weight: bold; }
        #stats { margin-top: 10px; font-size: 18px; }
    </style>
</head>
<body>
    <h1>數字易經</h1>
    <input type="text" id="numberInput" placeholder="輸入數字或字母串...">
    <button onclick="processInput()">轉換</button>
    <div id="output"></div>
    <div id="stats"></div>

    <script>
        const mapping = {
            "天": ["13", "27", "49", "68", "31", "72", "94", "86"],
            "延": ["19", "26", "34", "78", "91", "62", "43", "87"],
            "伏": ["00", "11", "22", "33", "44", "66", "77", "88", "99", "01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "20", "30", "40", "50", "60", "70", "80", "90", "15", "25", "35", "45", "65", "75", "85", "95", "05", "50", "51", "52", "53", "54", "56", "57", "58", "59"],
            "煞": ["16", "29", "38", "47", "61", "92", "83", "74"],
            "絕": ["12", "37", "48", "69", "21", "73", "84", "96"],
            "鬼": ["18", "24", "36", "79", "81", "42", "97", "63"],
            "禍": ["17", "23", "46", "89", "71", "32", "64", "98"],
            "生": ["14", "28", "39", "67", "41", "82", "93", "76"]
        };

        function letterToNumber(input) {
            return input.toUpperCase().split('').map(char => {
                if (char >= 'A' && char <= 'Z') {
                    return (char.charCodeAt(0) - 64).toString();
                }
                return char;
            }).join('');
        }

        function processInput() {
            let input = document.getElementById("numberInput").value;
            input = letterToNumber(input);

            if (!/^[0-9]+$/.test(input)) {
                document.getElementById("output").innerText = "請輸入純數字或字母！";
                return;
            }

            let filtered = input.split("").filter((num, index) => {
                if (num === "5") {
                    return index < 2 || index >= input.length - 2;
                }
                return true;
            }).join("");

            let pairs = [];
            for (let i = 0; i < filtered.length - 1; i++) {
                pairs.push(filtered.substring(i, i + 2));
            }

            let result = [];
            let counts = {};

            for (let i = 0; i < pairs.length; i++) {
                let matched = "伏";
                for (let key in mapping) {
                    if (mapping[key].includes(pairs[i])) {
                        matched = key;
                        break;
                    }
                }
                
                if (matched === "伏" && i > 0) {
                    matched = result[i - 1];
                }
                
                result.push(matched);
                counts[matched] = (counts[matched] || 0) + 1;
            }

            document.getElementById("output").innerText = result.join(" ");
            document.getElementById("stats").innerText = Object.entries(counts).map(([key, value]) => `${key}: ${value}`).join(" | ");
        }
    </script>
</body>
</html>
